# CGM 數據分析工具

這個 Streamlit 應用程序用於分析連續血糖監測（CGM）數據，提供重要指標的計算和視覺化。

## 主要功能

1. **文件上傳**：
   - 支持 CSV 和 Excel 文件格式
   - 要求文件包含 'Date'、'Time' 和 'Sensor Glucose (mg/dL)' 列

2. **數據處理**：
   - 合併 'Date' 和 'Time' 列以創建 'Timestamp' 列
   - 檢查必要列的存在性

3. **指標計算**：
   - 極低血糖（<54 mg/dL）
   - 低血糖（54-<70 mg/dL）
   - 目標範圍（70-180 mg/dL）
   - 高血糖（>180-250 mg/dL）
   - 極高血糖（>250 mg/dL）
   - 變異係數（CV）
   - 平均血糖值
   - 血糖管理指標（GMI）
   - 血糖風險指數（GRI）

4. **視覺化**：
   - 生成 Ambulatory Glucose Profile (AGP)
   - 顯示 5%、25%、50%（中位數）、75% 和 95% 百分位數
   - 設置 y 軸範圍為 40-400 mg/dL
   - 標記目標範圍（70-180 mg/dL）

## 主要邏輯流程

1. **文件讀取（read_file 函數）**：
   - 根據文件類型（CSV 或 Excel）讀取數據
   - 檢查必要列的存在性
   - 創建 'Timestamp' 列

2. **指標計算（calculate_metrics 函數）**：
   - 計算各種血糖水平的百分比
   - 計算 CV、平均血糖、GMI 和 GRI

3. **AGP 創建（create_agp 函數）**：
   - 將時間戳轉換為每日時間
   - 計算每個時間點的血糖百分位數
   - 創建填充區域圖表顯示血糖分佈

4. **主程序流程**：
   - 等待用戶上傳文件
   - 讀取和處理數據
   - 計算並顯示指標
   - 生成並顯示 AGP 圖表
   - 顯示數據預覽

## 使用說明

1. 運行應用程序：`streamlit run main.py`
2. 在瀏覽器中上傳 CGM 數據文件
3. 查看分析結果、AGP 圖表和數據預覽

注意：確保上傳的文件包含正確的列名，並且數據格式符合要求。